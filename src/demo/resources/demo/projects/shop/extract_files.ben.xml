<?xml version="1.0" encoding="utf-8"?>


<setup xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="https://www.benerator.de/schema/3.0.0"
       xsi:schemaLocation="https://www.benerator.de/schema/3.0.0 https://www.benerator.de/schema/benerator-3.0.0.xsd">

    <bean id="db" class="com.rapiddweller.platform.db.adapter.DBSystem">
        <property name="url" value="jdbc:oracle:thin:@localhost:1521:XE"/>
        <property name="driver" value="oracle.jdbc.driver.OracleDriver"/>
        <property name="user" value="benerator"/>
        <property name="password" value="benerator"/>
        <property name="batch" value="true"/>
    </bean>

    <iterate type="db_product" source="db">
        <consumer class="FixedWidthEntityExporter">
            <property name="uri" value="target/products.fcw"/>
            <property name="properties" value="ean_code[13],name[30l],price[10r0]"/>
        </consumer>
    </iterate>

    <bean id="csv" class="CSVEntityExporter">
        <property name="uri" value="target/customers.csv"/>
        <property name="properties" value="salutation,first_name,last_name"/>
    </bean>

    <bean id="proxy" class="shop.MyProxy">
        <property name="target" ref="csv"/>
    </bean>

    <bean id="log-csv" class="ConsumerChain">
        <property name="components">
            <bean id="logging_consumer" class="com.rapiddweller.model.consumer.LoggingConsumer"/>
            <idref bean="proxy"/>
        </property>
    </bean>

    <!-- this anonymizes the family name of the data extracted from the DB -->
    <iterate type="db_customer" source="db">
        <attribute name="last_name" generator="FamilyNameGenerator"/>
        <consumer ref="log-csv"/>
    </iterate>

    <!-- write a complete database snapshot to a DbUnit file -->
    <bean id="dbunit" class="DbUnitEntityExporter">
        <property name="uri" value="snapshot.xml"/>
    </bean>

    <iterate type="db_category" source="db" consumer="dbunit"/>
    <iterate type="db_product" source="db" consumer="dbunit"/>
    <iterate type="db_role" source="db" consumer="dbunit"/>
    <iterate type="db_user" source="db" consumer="dbunit"/>
    <iterate type="db_customer" source="db" consumer="dbunit"/>
    <iterate type="db_order" source="db" consumer="dbunit"/>
    <iterate type="db_order_item" source="db" consumer="dbunit"/>

</setup>